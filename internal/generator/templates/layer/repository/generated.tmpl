package generated

{{- $dpList := getTagDependencies .Tag }}
import (
    {{- if gt (len $dpList ) 0 }}
        {{- range $idx, $el := $dpList }}
            "{{ getRootFolderPath }}/internal/models/{{ $el }}"
        {{- end }}
    {{- end }}
    "gorm.io/gorm"
    "context"
)

type RepositoryImpl struct {
	Db *gorm.DB
}

func NewRepository(db *gorm.DB) *RepositoryImpl {
	return &RepositoryImpl{db}
}

{{ $paths := index $.Data.Tags .Tag }}
{{ range $paths -}}
    {{ range .Operations -}}
            {{ $xMeta := .XMeta }}
            //{{ if or (ne .Summary "") (ne .Description "") }} {{ upFirst .OperationId }} - Summary: {{ .Summary }}. Description: {{ .Description }} {{ end }}
            func (r *RepositoryImpl) {{ upFirst .OperationId }}(
                ctx context.Context,
               {{- if .RequestBody }}
                    {{- $modelName := .RequestBody.Content.ModelName }}
                    {{ if .RequestBody.IsArray -}}
                        {{ lowFirst $modelName }}DTO []*{{ lowFirst $modelName }}.{{ $modelName }}DTO, // {{ .Description }}
                    {{ else -}}
                        {{ lowFirst $modelName }}DTO *{{ lowFirst $modelName }}.{{ $modelName }}DTO,
                    {{- end }}
               {{- end }}
               {{- range .Parameters -}}
                    {{ $type := convertToGoType .Type .Format }}
                    {{ .Name }} {{ if .IsArray }} []{{ $type }} {{ else }} {{ $type }} {{ end }}, // Required: {{ .Required }}, Description: {{ .Description }}
               {{- end }}
            ) {{ getResponse . }} {
                {{ if and $xMeta ( eq $xMeta.Type "findbyid" ) }}
                {{ $id := index .Parameters 0 }}
                var entity *{{ .Tag }}.{{ $xMeta.Model.ModelName }}Entity
                if err := r.Db.WithContext(ctx).Preload(clause.Associations).First(&entity, {{ $id.Name }}).Error; err != nil {
                    return nil, err
                }
                return nil, nil
                {{ else }}
                 panic("not implemented")
                {{ end }}
            }
    {{ end -}}
{{ end }}